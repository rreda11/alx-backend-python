#!/bin/bash

set -e

echo "ğŸ”µ Deploying BLUE version..."
kubectl apply -f blue_deployment.yaml

echo "ğŸŸ¢ Deploying GREEN version..."
kubectl apply -f green_deployment.yaml

echo "ğŸ” Applying shared Service..."
kubectl apply -f kubeservice.yaml

echo "ğŸ” Checking logs for GREEN pod..."
GREEN_POD=$(kubectl get pods -l version=green -o jsonpath="{.items[0].metadata.name}")
kubectl logs "$GREEN_POD"

echo "âœ… Blue-Green deployment applied. Service currently points to: $(kubectl get service messaging-app-service -o=jsonpath='{.spec.selector.version}')"
